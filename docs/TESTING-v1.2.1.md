# v1.2.1 测试计划 - Commands & Hooks 功能

## 测试概述

本次更新新增了 Commands 和 Hooks 两个独立标签页，并修复了多个 bug。本文档提供完整的测试步骤和预期结果。

## 环境准备

### 前置条件

1. **安装 Claude Code CLI**
   ```bash
   # 确认已安装 claude CLI
   claude --version
   ```

2. **安装测试插件**
   ```bash
   # 安装几个常用插件用于测试
   claude plugin install plugin-dev
   claude plugin install document-skills
   claude plugin install superpowers
   ```

3. **配置 Hooks（可选）**
   - 手动编辑 `~/.claude/settings.json` 添加测试 hooks
   - 或在某个插件中添加 hooks 配置

4. **启动应用**
   ```bash
   npm run dev
   ```

---

## 测试清单

### ✅ 测试分组

- [A] Commands 标签页功能
- [B] Hooks 标签页功能
- [C] Tab Bar 布局
- [D] Bug 修复验证
- [E] UI 一致性检查
- [F] 回归测试

---

## A. Commands 标签页功能测试

### A1. 基础显示测试

**测试步骤：**
1. 打开应用，切换到右侧面板
2. 点击 **⌨️ 命令** 标签

**预期结果：**
- ✅ 标签页正常显示
- ✅ 显示标题 "命令 (X)" 其中 X 是命令总数
- ✅ 显示刷新按钮 (🔄)
- ✅ 显示搜索框（带 ⌕ 图标）
- ✅ 命令按分类分组显示
- ✅ **所有分类默认折叠状态（▶ 图标）**

### A2. 分类展开/折叠测试

**测试步骤：**
1. 点击任意分类标题

**预期结果：**
- ✅ 分类展开，显示该分类下的所有命令
- ✅ 图标从 ▶ 变为 ▼
- ✅ 再次点击折叠，图标恢复 ▶

### A3. 命令点击测试

**测试步骤：**
1. 展开任意分类
2. 点击一个命令项

**预期结果：**
- ✅ 左下角快捷输入框自动填入命令（格式：`/plugin-name:command-id`）
- ✅ 或者如果有简化名称，显示简化名称（格式：`/command`）
- ✅ 焦点移到输入框

### A4. 搜索功能测试

**测试步骤：**
1. 在搜索框输入关键词（如 "commit"）
2. 观察命令列表变化
3. 清空搜索框

**预期结果：**
- ✅ 仅显示匹配的命令
- ✅ 不匹配的分类被隐藏
- ✅ 清空后恢复显示所有命令

### A5. 刷新功能测试

**测试步骤：**
1. 点击刷新按钮 (🔄)

**预期结果：**
- ✅ 重新加载命令列表
- ✅ 显示加载状态（⏳ 图标）
- ✅ 加载完成后更新显示

### A6. 空状态测试

**测试步骤：**
1. 卸载所有插件
2. 刷新命令列表

**预期结果：**
- ✅ 显示空状态提示（⌨️ 图标）
- ✅ 显示提示文字 "未找到命令"

---

## B. Hooks 标签页功能测试

### B1. 基础显示测试

**测试步骤：**
1. 切换到右侧面板
2. 点击 **🪝 Hooks** 标签

**预期结果：**
- ✅ 标签页正常显示
- ✅ 显示标题 "Hooks (X)" 其中 X 是 hooks 总数
- ✅ 显示刷新按钮 (🔄)
- ✅ 显示搜索框（带 ⌕ 图标）
- ✅ Hooks 按事件类型分组显示
- ✅ **所有分类默认展开状态**（显示所有 hooks）

### B2. Hook 列表显示测试

**测试步骤：**
1. 查看任一展开的分类

**预期结果：**
- ✅ 每个 hook 显示名称、事件类型标签、描述信息
- ✅ 如果有 matcher，显示 matcher 文本（灰色等宽字体）
- ✅ 如果有 command，显示 command 文本（灰色等宽字体）
- ✅ 显示来源信息（插件名或 "settings"）
- ✅ 可编辑的 hook 显示 📝 图标
- ✅ 鼠标悬停时高亮显示（边框变为主题色）

### B3. Hook 编辑功能测试（核心功能）

**测试步骤：**
1. 点击任意可编辑的 hook
2. 等待编辑模态框打开
3. 查看模态框内容
4. 修改以下字段：
   - `matcher`: 修改匹配规则（如 `".*\\.js$"`）
   - `type`: 从下拉选择（Command、Bash、Block）
   - `command`: 修改命令内容
5. 点击 **保存** 按钮
6. 等待保存完成

**预期结果：**
- ✅ 模态框标题显示 "编辑 Hook"
- ✅ 使用 Naive UI 组件，样式与 PromptsTab 一致
- ✅ **输入框有清晰可见的边框**
- ✅ Event 字段只读（灰色背景，不可编辑）
- ✅ Matcher、Type、Command 字段可编辑
- ✅ Type 下拉菜单显示 3 个选项
- ✅ Command 输入框为多行文本框（4行）
- ✅ 保存按钮为蓝色主题色（Primary）
- ✅ 取消按钮为灰色默认样式
- ✅ **保存成功后显示绿色成功提示 "已保存"**
- ✅ 模态框自动关闭
- ✅ Hook 列表自动刷新，显示更新后的内容

### B4. Hook 编辑 - 错误处理测试

**测试步骤：**
1. 修改 hook 配置
2. 手动删除对应的 hooks.json 文件
3. 点击保存

**预期结果：**
- ✅ 显示错误提示 "保存失败"
- ✅ 模态框保持打开，不丢失编辑内容
- ✅ 控制台输出错误详情

### B5. Hook 编辑 - 取消操作测试

**测试步骤：**
1. 打开 hook 编辑模态框
2. 修改一些内容
3. 点击 **取消** 按钮

**预期结果：**
- ✅ 模态框关闭
- ✅ 修改未保存
- ✅ Hook 列表内容不变

### B6. Hook 编辑 - 深拷贝验证（Bug 修复）

**测试步骤：**
1. 打开 F12 开发者工具，切换到 Console 标签
2. 编辑并保存一个 hook
3. 查看是否有 "An object could not be cloned" 错误

**预期结果：**
- ✅ **不显示 "An object could not be cloned" 错误**
- ✅ 保存成功，无任何 IPC 序列化错误
- ✅ Hook 配置正确更新

### B7. 搜索功能测试

**测试步骤：**
1. 在搜索框输入关键词（如事件名称 "PreToolUse"）
2. 观察列表变化

**预期结果：**
- ✅ 仅显示匹配的 hooks
- ✅ 不匹配的分类被隐藏

---

## C. Tab Bar 布局测试

### C1. 标签显示完整性测试

**测试步骤：**
1. 打开应用，查看右侧面板顶部标签栏

**预期结果：**
- ✅ **所有 9 个标签均可见，无溢出或滚动**
- ✅ 标签顺序正确：
  ```
  💬 提示词 | 📜 队列 | 🔧 插件 | ⌨️ 命令 | ⚡ 技能 | 🪝 Hooks | 🌐 MCP | 🧩 Agents | 🤖 AI
  ```
- ✅ 标签按钮宽度为 28px
- ✅ 图标大小为 15px
- ✅ 每个标签图标清晰可辨

### C2. 标签切换测试

**测试步骤：**
1. 依次点击每个标签

**预期结果：**
- ✅ 每个标签点击后正确激活（蓝色高亮）
- ✅ 对应内容区正确切换
- ✅ 无布局错乱或内容重叠

---

## D. Bug 修复验证测试

### D1. Hooks 面板空白问题（Bug #1 修复验证）

**测试步骤：**
1. 确保至少安装了一个带 hooks 的插件
2. 打开 Hooks 标签页
3. 打开 F12 查看控制台

**预期结果：**
- ✅ Hooks 列表正常显示，不为空
- ✅ **控制台无 "getGlobalSettingsPath is not a function" 错误**
- ✅ **控制台无字段缺失相关错误**
- ✅ 每个 hook 都有 id 和 name 字段

### D2. AI 助手配置更新问题（Bug #3 修复验证）

**测试步骤：**
1. 打开 AI 助手标签页（🤖）
2. 点击设置图标（⚙️）打开设置面板
3. 点击 "API 配置管理" 按钮
4. 添加一个新的 API 配置
5. 关闭 API 配置管理窗口
6. 查看 AI 助手下拉列表

**预期结果：**
- ✅ **新添加的 API 配置出现在下拉列表中**
- ✅ 无需重启应用或手动刷新
- ✅ 可以立即选择并使用新配置

---

## E. UI 一致性检查

### E1. 模态框样式一致性测试

**测试步骤：**
1. 打开 Prompts 标签页，点击 "新建" 打开提示词编辑模态框
2. 截图或记住样式
3. 关闭模态框
4. 打开 Hooks 标签页，点击任一 hook 打开编辑模态框
5. 对比样式

**预期结果：**
- ✅ 两个模态框使用相同的 Naive UI 组件
- ✅ 输入框边框样式一致（宽度、颜色、圆角）
- ✅ 按钮样式一致（大小、颜色、间距）
- ✅ 表单标签样式一致（字体、颜色、对齐）
- ✅ 整体间距和布局风格统一

### E2. 空状态一致性测试

**测试步骤：**
1. 分别查看 Commands、Hooks、Skills、Agents 的空状态

**预期结果：**
- ✅ 所有空状态使用统一的设计
- ✅ 大图标 + 提示文字 + 灰色辅助说明
- ✅ 图标与标签页主题一致

### E3. 搜索框一致性测试

**测试步骤：**
1. 查看所有标签页的搜索框

**预期结果：**
- ✅ 所有搜索框使用统一的 ⌕ 图标
- ✅ 搜索框大小和位置一致
- ✅ placeholder 文字格式统一

---

## F. 回归测试（确保现有功能未受影响）

### F1. 其他标签页功能测试

**测试步骤：**
1. 测试 Prompts、Queue、Plugins、Skills、MCP、Agents、AI 标签页
2. 验证每个标签页的核心功能

**预期结果：**
- ✅ 所有现有功能正常工作
- ✅ 无因新增标签导致的功能退化

### F2. 左侧面板功能测试

**测试步骤：**
1. 测试项目列表、会话列表
2. 测试语言切换功能

**预期结果：**
- ✅ 项目和会话管理正常
- ✅ 中英文切换正常

### F3. 终端功能测试

**测试步骤：**
1. 创建新会话
2. 在终端输入命令
3. 测试快捷命令功能

**预期结果：**
- ✅ 终端正常工作
- ✅ 快捷命令可以发送

---

## G. 性能和稳定性测试

### G1. 大量 Hooks 加载测试

**测试步骤：**
1. 安装 10+ 个插件（尽量多的插件）
2. 打开 Hooks 标签页
3. 观察加载时间和渲染性能

**预期结果：**
- ✅ 加载时间 < 2 秒
- ✅ 滚动流畅，无卡顿
- ✅ 分类展开/折叠响应迅速

### G2. 连续编辑测试

**测试步骤：**
1. 连续编辑并保存 5 个不同的 hooks
2. 每次保存后立即编辑下一个

**预期结果：**
- ✅ 每次保存都成功
- ✅ 无内存泄漏或性能下降
- ✅ 界面响应正常

### G3. 长时间运行测试

**测试步骤：**
1. 保持应用运行 30 分钟
2. 在此期间多次切换标签页
3. 执行各种操作（搜索、编辑、刷新）

**预期结果：**
- ✅ 应用稳定运行，无崩溃
- ✅ 内存占用无异常增长
- ✅ 所有功能持续正常工作

---

## H. 国际化测试

### H1. 中文界面测试

**测试步骤：**
1. 切换到中文界面
2. 检查 Commands 和 Hooks 标签页的所有文本

**预期结果：**
- ✅ 所有标签、按钮、提示文字显示中文
- ✅ 无乱码或缺失翻译

### H2. 英文界面测试

**测试步骤：**
1. 切换到英文界面
2. 检查 Commands 和 Hooks 标签页的所有文本

**预期结果：**
- ✅ 所有文本正确显示英文
- ✅ 翻译准确，无语法错误

---

## I. 边界情况测试

### I1. 无插件场景

**测试步骤：**
1. 卸载所有插件
2. 打开 Commands 和 Hooks 标签页

**预期结果：**
- ✅ 显示空状态，无错误
- ✅ 刷新按钮仍可用

### I2. Hook 文件权限问题

**测试步骤：**
1. 将某个 hooks.json 文件设为只读
2. 尝试编辑该文件中的 hook

**预期结果：**
- ✅ 显示保存失败错误提示
- ✅ 应用不崩溃

### I3. 无效 JSON 配置

**测试步骤：**
1. 手动破坏某个插件的 hooks.json（添加语法错误）
2. 刷新 Hooks 列表

**预期结果：**
- ✅ 其他 hooks 正常显示
- ✅ 控制台输出错误信息，但不影响整体功能

---

## 测试报告模板

```markdown
## 测试报告 - v1.2.1

**测试日期**: YYYY-MM-DD
**测试人员**: [姓名]
**测试环境**:
- OS: [Windows/macOS/Linux]
- Node.js: [版本]
- Electron: [版本]
- Claude CLI: [版本]

### 测试结果汇总

| 测试分组 | 通过 | 失败 | 跳过 |
|---------|------|------|------|
| A. Commands 标签页 | X/6 | X/6 | X/6 |
| B. Hooks 标签页 | X/7 | X/7 | X/7 |
| C. Tab Bar 布局 | X/2 | X/2 | X/2 |
| D. Bug 修复验证 | X/2 | X/2 | X/2 |
| E. UI 一致性 | X/3 | X/3 | X/3 |
| F. 回归测试 | X/3 | X/3 | X/3 |
| G. 性能测试 | X/3 | X/3 | X/3 |
| H. 国际化 | X/2 | X/2 | X/2 |
| I. 边界情况 | X/3 | X/3 | X/3 |
| **总计** | **X/31** | **X/31** | **X/31** |

### 发现的问题

#### 严重问题 (Blocker)
- [ ] 无

#### 高优先级问题 (High)
- [ ] 描述问题...

#### 中优先级问题 (Medium)
- [ ] 描述问题...

#### 低优先级问题 (Low)
- [ ] 描述问题...

### 测试结论

- [ ] ✅ 通过所有测试，可以发布
- [ ] ⚠️ 存在非阻塞性问题，可以发布但需后续修复
- [ ] ❌ 存在严重问题，不建议发布

### 备注

[其他需要说明的内容]
```

---

## 快速测试清单（核心功能验证）

如果时间有限，至少执行以下核心测试：

- [ ] A1. Commands 标签页基础显示
- [ ] A3. 命令点击插入功能
- [ ] B1. Hooks 标签页基础显示
- [ ] **B3. Hook 编辑功能（重点）**
- [ ] **B6. 深拷贝验证（Bug 修复）**
- [ ] C1. 9 个标签全部可见
- [ ] D1. Hooks 面板不为空
- [ ] D2. AI 配置列表更新
- [ ] E1. 模态框样式一致

---

## 附录：测试数据准备

### 创建测试 Hook 配置

在 `~/.claude/settings.json` 中添加：

```json
{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "tool == 'Bash' && command.includes('rm')",
        "hooks": [
          {
            "type": "block",
            "command": "Dangerous command blocked for safety"
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "hooks": [
          {
            "type": "bash",
            "command": "echo 'Tool used at' $(date)"
          }
        ]
      }
    ]
  }
}
```

### 推荐安装的测试插件

```bash
claude plugin install plugin-dev          # 提供多个 commands
claude plugin install document-skills     # 提供大量 skills
claude plugin install superpowers         # 提供 agents 和 skills
```

---

**测试愉快！如有问题请及时反馈。**
